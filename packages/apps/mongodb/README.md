# MongoDB

Production-ready MongoDB deployment for Cozystack tenants built on the Bitnami MongoDB chart.

## Parameters

### Topology
| Name | Description | Type | Default |
| --- | --- | --- | --- |
| `architecture` | Deployment architecture (`standalone` or `replicaset`). | `string` | `replicaset` |
| `replicaCount` | Number of MongoDB replicas (replica set only). | `int` | `3` |
| `replicaSetName` | Optional replica set name (defaults to release name). | `string` | `""` |
| `arbiter.enabled` | Deploy an arbiter node. | `bool` | `false` |

### Authentication
| Name | Description | Type | Default |
| --- | --- | --- | --- |
| `auth.enabled` | Enable SCRAM authentication. | `bool` | `true` |
| `auth.rootUser` | Admin user name. | `string` | `root` |
| `auth.rootPassword` | Admin password (required unless `auth.existingSecret` is set). | `string` | `""` |
| `auth.username` | Optional application user. | `string` | `""` |
| `auth.password` | Password for the optional application user. | `string` | `""` |
| `auth.database` | Database for the optional application user. | `string` | `""` |
| `auth.replicaSetKey` | Replica set keyfile value for intra-node authentication. | `string` | `""` |
| `auth.existingSecret` | Secret containing `mongodb-root-password` and `mongodb-replica-set-key` keys. | `string` | `""` |

### Persistence
| Name | Description | Type | Default |
| --- | --- | --- | --- |
| `persistence.enabled` | Enable persistent volumes. | `bool` | `true` |
| `persistence.size` | Volume size per pod. | `string` | `20Gi` |
| `persistence.storageClass` | StorageClass to use (empty = cluster default). | `string` | `""` |
| `persistence.accessModes` | PVC access modes. | `array` | `["ReadWriteOnce"]` |

### Service & Networking
| Name | Description | Type | Default |
| --- | --- | --- | --- |
| `service.type` | Kubernetes Service type. | `string` | `ClusterIP` |
| `service.port` | MongoDB service port. | `int` | `27017` |

### TLS
| Name | Description | Type | Default |
| --- | --- | --- | --- |
| `tls.enabled` | Enable TLS for MongoDB connections. | `bool` | `false` |
| `tls.autoGenerated` | Auto-generate self-signed certs when no secret is provided. | `bool` | `true` |
| `tls.existingSecret` | Reuse an existing TLS secret. | `string` | `""` |

### Monitoring
| Name | Description | Type | Default |
| --- | --- | --- | --- |
| `metrics.enabled` | Deploy metrics exporter sidecar. | `bool` | `true` |
| `metrics.serviceMonitor.enabled` | Create a ServiceMonitor for Prometheus Operator. | `bool` | `false` |
| `metrics.serviceMonitor.namespace` | Namespace for the ServiceMonitor. | `string` | `""` |
| `metrics.serviceMonitor.interval` | Scrape interval for the ServiceMonitor. | `string` | `30s` |

### Resources
| Name | Description | Type | Default |
| --- | --- | --- | --- |
| `resources.requests.cpu` | CPU request per pod. | `string` | `250m` |
| `resources.requests.memory` | Memory request per pod. | `string` | `512Mi` |
| `resources.limits.cpu` | CPU limit per pod. | `string` | `1000m` |
| `resources.limits.memory` | Memory limit per pod. | `string` | `2Gi` |

## Usage notes
- Set `auth.rootPassword` and `auth.replicaSetKey`, or provide them via `auth.existingSecret`, before deploying to production.
- Enable TLS (`tls.enabled=true`) and point to your certificates for encrypted traffic.
- Turn on `metrics.serviceMonitor.enabled` when the Prometheus Operator is present in the cluster.
